<!DOCTYPE html>
<html>
	<head>
		<title></title>
		<meta http-equiv=Content-Type content="text/html; charset=utf-8">
		<meta content="MSHTML 6.00.2600.0" name=GENERATOR>
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
		 crossorigin="anonymous">
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
		 crossorigin="anonymous"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
		 crossorigin="anonymous"></script>
		<script type="text/javascript" src="webuploader/webuploader.min.js"></script>
		<link rel="stylesheet" href="css/upload.css" />
		<script type="text/javascript" src="js/upload.js"></script>
		<link rel="stylesheet" href="webuploader/webuploader.css" />
		<script type="text/javascript" src="js/jqthumb.js"></script>
		<link rel="stylesheet" href="css/box.css" />
		<script src="js/template.js"></script>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	</head>
	<body>
		<body style="background-color: beige;">
			<div class="container">
				<nav class="navbar navbar-expand-lg navbar-light bg-light">
					<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo01"
					 aria-controls="navbarTogglerDemo01" aria-expanded="false" aria-label="Toggle navigation">
						<span class="navbar-toggler-icon"></span>
					</button>
					<div class="collapse navbar-collapse" id="navbarTogglerDemo01">
						<a class="navbar-brand" href="#">Hidden brand</a>
						<ul class="navbar-nav mr-auto mt-2 mt-lg-0">
							<li class="nav-item active">
								<a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
							</li>
							<li class="nav-item">
								<a class="nav-link" href="#">Link</a>
							</li>
							<li class="nav-item">
								<a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">Disabled</a>
							</li>
						</ul>
						<form class="form-inline my-2 my-lg-0" style="position: relative; right: 20px;">
							<input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
							<button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
						</form>
						<!-- Example single danger button -->
						<div class="btn-group">
							<img id="profile_face" src="images/default.png" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"
							 class="img-circle" height="40px" style="border-radius:50%;cursor: pointer;" />
							<div class="dropdown-menu">
								<a class="dropdown-item" href="#">Action</a>
								<a class="dropdown-item" href="#">Another action</a>
								<a class="dropdown-item" href="#">Something else here</a>
								<div class="dropdown-divider"></div>
								<a class="dropdown-item" href="#">Separated link</a>
							</div>
						</div>
					</div>
				</nav>
				<div class="row">
					<div class="col-3">
						&nbsp
						<div class="card">
							<div style="background-color: #EF3B3A; height: 100px;">
								<img id="profile_face1" src="images/default.png" alt="..." class="img-thumbnail" height="80px" width="80px"
								 style="border-radius:50%;position: relative; top: 60px; left: 20px;">
								<button id="btn_relation" onclick="changeRelation()" class="btn btn-outline-primary"></button>
							</div>
							<div class="card-body">
								<a style="position: relative;left: 90px; top: -20px;">
									<p id="profile_username"></p>
								</a>
								<ul class="list-group">
									<li class="list-group-item d-flex justify-content-between align-items-center">
										微博
										<span id="profile_weiboCount" class="badge badge-primary badge-pill">14</span>
									</li>
									<li class="list-group-item d-flex justify-content-between align-items-center">
										关注
										<span id="profile_followCount" class="badge badge-primary badge-pill">2</span>
									</li>
									<li class="list-group-item d-flex justify-content-between align-items-center">
										粉丝
										<span id="profile_fansCount" class="badge badge-primary badge-pill">1</span>
									</li>
								</ul>
							</div>
						</div>
					</div>
					<div class="col-6">
						&nbsp 
						<div id="weiboDiv">
						</div>
						<nav aria-label="Page navigation example">
							<ul class="pagination">
								<li class="page-item">
									<a class="page-link" href="#" aria-label="Previous">
										<span aria-hidden="true">&laquo;</span>
									</a>
								</li>
								<li class="page-item"><a class="page-link" onclick="queryUserWeibo(1)">1</a></li>
								<li class="page-item"><a class="page-link" onclick="queryUserWeibo(2)">2</a></li>
								<li class="page-item"><a class="page-link" onclick="queryUserWeibo(3)">3</a></li>
								<li class="page-item"><a class="page-link" onclick="queryUserWeibo(4)">4</a></li>
								<li class="page-item"><a class="page-link" onclick="queryUserWeibo(5)">5</a></li>
								<li class="page-item"><a class="page-link" onclick="queryUserWeibo(6)">6</a></li>
								<li class="page-item"><a class="page-link" onclick="queryUserWeibo(7)">7</a></li>
								<li class="page-item"><a class="page-link" onclick="queryUserWeibo(8)">8</a></li>
								<li class="page-item"><a class="page-link" onclick="queryUserWeibo(9)">9</a></li>
								<li class="page-item"><a class="page-link" onclick="queryUserWeibo(10)">10</a></li>
								<li class="page-item"><a class="page-link" onclick="queryUserWeibo(11)">11</a></li>
								<li class="page-item"><a class="page-link" onclick="queryUserWeibo(12)">12</a></li>
								<li class="page-item"><a class="page-link" onclick="queryUserWeibo(13)">13</a></li>
								<li class="page-item">
									<a class="page-link" href="#" aria-label="Next">
										<span aria-hidden="true">&raquo;</span>
									</a>
								</li>
							</ul>
						</nav>
					</div>
					<div class="col-3">
						&nbsp
					</div>
				</div>
			</div>
		</body>
		<script>
			loadUserInfo();
			function loadUserInfo(){
				var url = window.location.href;
				var id = url.substring(url.indexOf('userid')+7);
				queryUser(id);
				queryUserWeibo(1);
			}
			
			function changeRelation(){
				if($('#btn_relation')[0].innerHTML == '我自己'){
					return;
				}
				var url = window.location.href;
				var id = url.substring(url.indexOf('userid')+7);
				var token = getCookie('token');
				var headers = { Accept:"application/json; charset=utf-8",Authorization:token};
				var data = {};
				data.profileId = id;
				var queryUserxhr = $.ajax({
					url:'changeRelation.action',
					dataType: 'json',
					method:'POST',
					data:data,
					headers:headers,
					success:successCall,
					error:errorCall});
								
				function successCall(data){
					console.log('成功, 收到的数据: '+data);
					if(data.code == 1){
						queryUser(id);
					}
				}
				function errorCall(error){
					console.log('请求出错'+error);
				}
			}
			
			
			function getCookie(cname) {
				var name = cname + "=";
				var ca = document.cookie.split(';');
				for (var i = 0; i < ca.length; i++) {
					var c = ca[i].trim();
					if (c.indexOf(name) == 0) return c.substring(name.length, c.length);
				}
				return "";
			}
			
			function queryUser(userId){
				var token = getCookie('token');
				var headers = { Accept:"application/json; charset=utf-8",Authorization:token};
				var data = {};
				data.profileId = userId;
				var queryUserxhr = $.ajax({
					url:'users/profile',
					dataType: 'json',
					method:'GET',
					data:data,
					headers:headers,
					success:successCall,
					error:errorCall});
								
				function successCall(responseResult){
					console.log('成功, 收到的数据: '+data.relation);
					if(responseResult.code == 1){
						var userInfo = responseResult.data;
						$('#profile_face').attr('src', '/imgUpload/' + userInfo.face);
						$('#profile_face1').attr('src', '/imgUpload/' + userInfo.face);
						$('#profile_username').text(userInfo.username);
						$('#profile_weiboCount').text(userInfo.weiboCount);
						$('#profile_followCount').text(userInfo.followCount);
						$('#profile_fansCount').text(userInfo.fansCount);
						console.log(userInfo.relation);
						if(userInfo.relation.relationId != null){
							$('#btn_relation').text('正在关注');
						}else if(userInfo.relation.followId == userInfo.relation.userId){
							$('#btn_relation').text('我自己');	
						}else{
							$('#btn_relation').text('关注');	
						}
					}else{
						alert(responseResult.msg);
					}

					
				}
				function errorCall(error){
					console.log('请求出错'+error);
				}
			}
			
			function queryUserWeibo(page) {
				var url = window.location.href;
				var id = url.substring(url.indexOf('userid')+7);
				console.log(id)
				var token = getCookie('token');
				var headers = { Accept:"application/json; charset=utf-8",Authorization:token};
			
				var data = {};
				data.userId = id;
				data.pageNum = page;
				data.pageSize = 10;
				
				
				var queryUserWeiboxhr = $.ajax({
					url:'weibo/someone',
					dataType: 'json',
					data:data,
					headers:headers,
					method:'GET',
					success:successCall,
					error:errorCall});
								
				function successCall(responseResult){
					console.log('成功, 收到的数据: '+responseResult);
					if(responseResult.code == 1){
						var result = responseResult.data;
						var payload = {};
						for(var i=0;i<result.length;i++){
							result[i].user.face = '/imgUpload/'+result[i].user.face;
							for(var q=0;q<9;q++){
								if(result[i]['pic'+q]!==null){
									var z =q+1;
									result[i]['pic'+z] = '/imgUpload/'+result[i]['pic'+z]; 
								}
							}
						}
						payload.list = result;
						var html = template(document.getElementById('weiList').innerHTML,payload);
						document.getElementById('weiboDiv').innerHTML = html;
					}

				}
				function errorCall(error){
					console.log('请求出错'+JSON.stringify(error));
				}
			}
		</script>


		<script id="weiList" type="text/html">
			<%for(var i = 0; i < list.length; i++) {%>
									<div class="card">
					<div class="card-body" style="padding:10px;" id=<%:='weiboCard'+list[i].weiboId%> >
						<div class="row" id=<%:='weiboRow'+list[i].weiboId%>  >
							<div class="col-1" style="padding-right: 0px;">
								<img src="<%:=list[i].user.face%>" alt="..." class="img-circles" height="48px" width="48px" style="border-radius:50%" />
							</div>
							<div class="col-11" style="padding-left: 30px;">
								<div class="row align-items-start" style="margin-right: 0px;" data-toggle="modal" data-whatever=<%:=list[i].weiboId%> data-target="#weiboModal">
									<div class="col" style="position: relative;left: 0px;">
										<a href=<%:='user.html?userId='+list[i].user.userId%> target="_blank" style="position: relative;left: 0px;"><%:=list[i].user.username%></a>
										<span><%:=list[i].date%></span>
									</div>
									<div class="col" style="margin: 0px; padding: 0px;">
										<div class="btn-group" style="float: right;">
											<button type="button" class="btn dropdown-toggle dropdown-toggle-split" data-toggle="dropdown"
											 aria-haspopup="true" aria-expanded="false">
												<span class="sr-only">Toggle Dropdown</span>
											</button>
											<div class="dropdown-menu">
												<a class="dropdown-item" href="#">Action</a>
												<a class="dropdown-item" href="#">Another action</a>
												<a class="dropdown-item" href="#">Something else here</a>
												<div class="dropdown-divider"></div>
												<a class="dropdown-item" href="#">Separated link</a>
											</div>
										</div>
									</div>
								</div>
								<div class="row align-items-center">
									<div class="col-11">
										<span><%:=list[i].content%></span>
									</div>
								</div>
								<div class="row align-items-center" style="padding-top: 20px;">
									<div class="col-10">
										<%if(list[i].imgCount == 1){%>
											<img class="img-fluid" src=<%:=list[i].pic1%> />
										<%}%>
										<%if(list[i].imgCount == 2){%>
										<div class="row">
											<div class="col">										
												<img class="img-fluid" src=<%:=list[i].pic1%> />
											</div>
											<div class="col">
												<img class="img-fluid" src=<%:=list[i].pic2%> />
											</div>
										</div>
										<%}%>
										<%if(list[i].imgCount == 3){%>
										<div class="row">
											<div class="col-8">										
												<img class="img-fluid" src=<%:=list[i].pic1%> />
											</div>
											<div class="col-4">
												<img class="img-fluid" src=<%:=list[i].pic2%> />
												<img class="img-fluid" src=<%:=list[i].pic3%> />
											</div>
										</div>
										<%}%>
										<%if(list[i].imgCount == 4){%>
										<div class="row">
											<div class="col">										
												<img class="img-fluid" src=<%:=list[i].pic1%> />
												<img class="img-fluid" src=<%:=list[i].pic3%> />
											</div>
											<div class="col">
												<img class="img-fluid" src=<%:=list[i].pic2%> />
												<img class="img-fluid" src=<%:=list[i].pic4%> />
											</div>
										</div>
										<%}%>
									</div>
								</div>
				
								<div class="row align-items-end" style="margin-top: 20px;">
									<div class="col-2">
										<i class="fa fa-comment-o"></i>
										<span id="commentNum"></span>
									</div>
									<div class="col-2">
										<i class="fa fa-clone" ></i>
										<span id="repostNum"></span>
									</div>
									<div class="col-2">
										<i class="fa fa-heart-o"></i>
										<span id="likeNum"></span>
									</div>
									<div class="col-2">
										<i class="fa fa-bookmark-o"></i>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<%}%>
		</script>
</html>
